下面给你一份 **可直接写进报告或答辩材料的「问题定位与修复方案说明」** ，偏工程化表达，逻辑完整、可复现、可验证。

---

# 一、问题现象

在 Docker 部署后端与 MySQL 服务后：

* 数据库中已确认存储为正常中文（如“降压药”）
* 后端接口或页面显示为乱码：`é™åŽ‹è¯`
* 本地非 Docker 环境运行正常

说明问题出现在  **容器化部署后的服务—数据库通信链路中** 。

---

# 二、问题定位过程

## 1. 排除存储层问题（数据库字符集）

进入 MySQL 容器检查字符集配置：

```bash
SHOW VARIABLES LIKE 'character_set%';
SHOW VARIABLES LIKE 'collation%';
```

结果显示：

* `character_set_server = utf8mb4`
* `character_set_database = utf8mb4`
* 表与字段内容为正常中文

结论：
👉 **数据库存储层编码正确，问题不在数据写入阶段。**

---

## 2. 发现连接会话层字符集异常

继续关注会话级变量：

```text
character_set_client     = latin1
character_set_connection = latin1
character_set_results    = latin1
collation_connection     = latin1_swedish_ci
```

这表示：

* MySQL 与客户端（JDBC）之间的通信编码被协商为 latin1
* MySQL 将 utf8mb4 的中文按 latin1 方式发送给客户端
* 客户端再按 UTF-8 解码 → 形成典型乱码：`é™åŽ‹è¯`

结论：
👉 **乱码发生在 MySQL → JDBC 返回结果的解码阶段，而非数据库存储阶段。**

---

## 3. 追溯 JDBC 连接配置变更

检查历史配置发现：

* 原 JDBC URL 中包含字符集参数
* 为解决后端循环启动问题，被移除了编码相关参数
* 删除后 JDBC 未再声明连接字符集
* MySQL 按默认规则回退使用 latin1 会话编码

结论：
👉 启动问题被修复，但引入了新的编码协商错误，属于“规避式修复”。

---

# 三、问题根因分析

### 根因可归纳为三点：

1. MySQL 服务器字符集为 utf8mb4（正确）
2. JDBC 连接未声明客户端字符集
3. MySQL 默认会话编码回退为 latin1

导致：

> UTF-8 中文 → 被当作 Latin1 字节流发送 → 客户端错误解码 → 乱码

该问题只在 Docker 环境中出现，是因为：

* 容器环境不会继承本机默认 locale
* JDBC 与 MySQL 的字符集协商完全依赖连接参数

---

# 四、修复方案设计

目标：

> 强制 JDBC 连接会话使用 utf8mb4 编码进行通信。

---

## ✅ 方案一（推荐）：在 JDBC URL 中明确指定字符集

在 `application.properties` 或 docker-compose 环境变量中配置：

```properties
spring.datasource.url=
jdbc:mysql://mysql:3306/数据库名
?useUnicode=true
&characterEncoding=utf8
&connectionCollation=utf8mb4_unicode_ci
&serverTimezone=Asia/Shanghai
```

说明：

* `characterEncoding=utf8` 在 MySQL Connector/J 8.x 中等价于 utf8mb4
* `connectionCollation` 明确指定 utf8mb4 排序规则
* 可避免不同驱动版本对 utf8mb4 参数解析差异

---

## ⚠ 不采用方案

| 方案                                  | 原因                               |
| ------------------------------------- | ---------------------------------- |
| 在 MySQL 中执行 `SET NAMES utf8mb4` | 仅对当前会话有效，连接池重连即失效 |
| 修改 MySQL server 默认字符集          | 无法解决客户端解码错误             |
| 仅修改 JVM file.encoding              | 只影响日志输出，不影响数据库通信   |

---

# 五、修复验证方法

重启全部容器后执行：

```bash
SHOW VARIABLES LIKE 'character_set_%';
```

期望结果：

```text
character_set_client     = utf8mb4
character_set_connection = utf8mb4
character_set_results    = utf8mb4
```

同时验证：

* 接口返回中文正常
* 页面显示中文正常

确认：

> 数据库存储编码 + 会话通信编码 + 客户端解码编码 全链路一致。

---

# 六、经验总结

1. Docker 化部署会放大编码与环境依赖问题
2. 中文乱码必须区分：
   * 存储乱码
   * 传输乱码
   * 显示乱码
3. 删除配置解决启动问题但不分析根因，容易引入隐性缺陷
4. 数据库字符集正确 ≠ 通信字符集正确

本问题的本质是：

> **字符集协商失败导致的跨层解码错误，而非数据库或前端问题。**

---

如果你需要，我也可以再给你一版**更偏课程报告风格 / 更偏工程总结风格**的不同版本，用于不同提交场景。
