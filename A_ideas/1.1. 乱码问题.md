这是一个 **典型且高频的中文乱码问题** ，而且你这个表现形式——`é™åŽ‹è¯`——非常有特征性：
👉 **UTF-8 被当成 ISO-8859-1（或 Latin-1）解码了。**
也就是说：**数据本身是对的，但在某一层被用错了字符集来解释。**

在 Docker 场景下，这类问题通常不是“一个地方”的锅，而是 **链路某一层字符集不一致** 。建议你按下面这个优先级去排查。

---

# 一、先判断：乱码出现在哪一层？

你先明确一点（非常关键）：

| 场景                     | 说明                                   |
| ------------------------ | -------------------------------------- |
| 日志里乱码               | JVM / Python / Node 进程输出被错误解码 |
| API 返回乱码             | Web 框架响应编码错误                   |
| 数据库里就是乱码         | 写入时就错了                           |
| 前端显示乱码但接口是对的 | 前端解码问题                           |

👉 建议你直接做两件事：

1. **curl 接口看原始返回是否乱码**
2. **进数据库查原始字段是否乱码**

这一步能直接定位：是 **存错了** ，还是 **显示错了** 。

---

# 二、最高优先级排查：数据库字符集（非常可能）

IoT 项目 + Docker + 中文乱码， **80% 是数据库容器字符集问题** 。

## 1. 查数据库字符集

进 MySQL 容器：

```bash
docker exec -it mysql容器名 mysql -uroot -p
```

执行：

```sql
SHOW VARIABLES LIKE 'character_set%';
SHOW VARIABLES LIKE 'collation%';
```

重点看：

* character_set_server
* character_set_database
* character_set_connection

👉 正常应全部是：

```
utf8mb4
utf8mb4_general_ci 或 utf8mb4_unicode_ci
```

如果你看到：

* latin1
* 或混杂 utf8 / latin1

那基本可以确认： **库本身就不对** 。

---

## 2. 表和字段级字符集

即使库是 utf8mb4，表也可能不是：

```sql
SHOW CREATE TABLE 表名;
```

看字段后面是否有：

```sql
CHARSET=latin1
```

或者字段级：

```sql
varchar(255) CHARACTER SET latin1
```

👉 如果是：那是历史遗留问题，写入时就已经错了。

---

# 三、服务端编码：Java / Python Web 层

如果数据库里是正常中文，但接口返回乱码，那就查服务端。

---

## ✅ Java 项目常见雷区

### 1. JDBC 连接串是否带编码

看配置：

```properties
spring.datasource.url=jdbc:mysql://mysql:3306/dbname
```

必须包含：

```text
useUnicode=true&characterEncoding=utf8&serverTimezone=UTC
```

正确示例：

```text
jdbc:mysql://mysql:3306/dbname?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
```

---

### 2. Tomcat / Spring Boot 默认编码

Docker 里 JVM 启动参数：

```bash
-Dfile.encoding=UTF-8
```

可在 Dockerfile 或 docker-compose 中：

```yaml
environment:
  - JAVA_TOOL_OPTIONS=-Dfile.encoding=UTF-8
```

但注意：
👉 这只能解决 **输出乱码** ，解决不了数据库已乱码的数据。

---

## ✅ Python Flask / FastAPI

通常问题在：

* 返回 response 时未指定 charset
* 数据库驱动解码错误

但只要数据库是 utf8mb4，一般不会出现你这种乱码形式。

---

# 四、Docker 环境层：系统 locale（次要但可能）

有些基础镜像默认是：

```text
LANG=C
```

导致程序输出乱码。

进容器：

```bash
locale
```

如果看到：

```
LANG=C
LC_ALL=
```

那可以在 Dockerfile 加：

```dockerfile
ENV LANG=C.UTF-8
ENV LC_ALL=C.UTF-8
```

⚠️ 但我要强调：
👉 这只影响 **日志和终端显示** ，不会影响数据库里存储的字符。

---

# 五、最可能的真实情况（按经验判断）

结合你说的：

> 前任能跑，我 Docker 后出现乱码
> 指定字符集也无效

非常像以下情况之一：

### 情况 A（最常见）

* 原项目在本机 MySQL，默认 utf8mb4
* 你 Docker 起了新 MySQL，默认 latin1
* 服务写入时没报错，但存进去就是乱码

👉 这类乱码是 **不可逆的** ，必须重新导入数据。

---

### 情况 B

* Docker MySQL 镜像初始化 SQL 里没指定 charset
* 建表语句本身是 latin1

👉 即使你后来改库字符集，表也还是错的。

---

# 六、你现在可以按这个顺序行动（非常实用）

## Step 1：确认是不是数据库层问题

```sql
SELECT 字段 FROM 表;
```

如果数据库里就是 `é™åŽ‹è¯`
→ 直接去看建库建表脚本。

---

## Step 2：检查初始化 SQL / migration

重点找：

* `.sql` 初始化脚本
* Docker volumes 里的旧数据

搜索：

```sql
CHARSET=
SET NAMES
```

正确应该是：

```sql
SET NAMES utf8mb4;
CREATE DATABASE ... CHARACTER SET utf8mb4;
```

---

## Step 3：看 docker-compose.yml

是否有：

```yaml
command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
```

如果没有，MySQL 可能默认 latin1。

---

## Step 4：再回头看服务编码配置

只有在数据库确认正常后，才去纠结：

* JDBC
* Spring encoding
* Tomcat connector

否则是本末倒置。

---

# 七、如果你愿意给我这些信息，我可以直接帮你定位

你可以贴任意一部分（不必全给）：

1. docker-compose 里 MySQL 服务配置
2. 数据库 `SHOW VARIABLES LIKE 'character_set%';` 结果
3. 建表 SQL
4. 哪一层看到乱码（接口 / 页面 / DB）

我可以直接告诉你：
👉 是数据库初始化问题，还是服务层编码问题，还是 Docker locale 问题。

从你描述来看， **优先查数据库字符集和初始化脚本** ，这是最高性价比的排查路径。
